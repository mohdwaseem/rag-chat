<div class="admin-container">
  <p-toast></p-toast>

  <p-card class="admin-card">
    <ng-template pTemplate="header">
      <div class="card-header">
        <h3><i class="pi pi-cog"></i> {{ 'admin.title' | translate }}</h3>
      </div>
    </ng-template>

    <div class="admin-content">
      <!-- Document Upload Section -->
      <div class="section">
        <h4><i class="pi pi-file-pdf"></i> {{ 'admin.documentUpload.title' | translate }}</h4>
        <p>{{ 'admin.documentUpload.description' | translate }}</p>
        <app-document-upload (documentUploaded)="onDocumentUploaded()"></app-document-upload>
      </div>

      <div class="divider"></div>

      <!-- System Status Section -->
      <div class="section">
        <h4><i class="pi pi-chart-bar"></i> {{ 'admin.systemStatus.title' | translate }}</h4>
        <p>{{ 'admin.systemStatus.description' | translate }}</p>

        <div class="status-actions">
          <button pButton
                  icon="pi pi-heart"
                  [label]="'admin.systemStatus.healthButton' | translate"
                  class="p-button-outlined"
                  (click)="loadHealth()"
                  [loading]="(isLoadingHealth$ | async) ?? false"
                  [disabled]="(isLoadingHealth$ | async) ?? false"></button>
          <button pButton
                  icon="pi pi-chart-line"
                  [label]="'admin.systemStatus.statsButton' | translate"
                  class="p-button-outlined"
                  (click)="loadStats()"
                  [loading]="(isLoadingStats$ | async) ?? false"
                  [disabled]="(isLoadingStats$ | async) ?? false"></button>
          <button pButton
                  icon="pi pi-database"
                  [label]="'admin.systemStatus.sourcesButton' | translate"
                  class="p-button-outlined"
                  (click)="loadSources()"
                  [loading]="(isLoadingSources$ | async) ?? false"
                  [disabled]="(isLoadingSources$ | async) ?? false"></button>
          <button pButton
            icon="pi pi-user"
            [label]="'admin.systemStatus.meButton' | translate"
            class="p-button-outlined"
            (click)="loadMe()"
                  [loading]="(isLoadingMe$ | async) ?? false"
                  [disabled]="(isLoadingMe$ | async) ?? false"></button>
        </div>

        <div class="status-grid" *ngIf="(healthStatus$ | async) || (stats$ | async)">
          <div class="status-card" *ngIf="healthStatus$ | async as healthStatus">
            <h5>{{ 'admin.systemStatus.healthTitle' | translate }}</h5>
            <p>{{ healthStatus.status }}</p>
            <small>{{ healthStatus.timestamp }}</small>
          </div>

          <div class="status-card" *ngIf="stats$ | async as stats">
            <h5>{{ 'admin.systemStatus.statsTitle' | translate }}</h5>
            <p>{{ 'admin.systemStatus.documentChunks' | translate }}: {{ stats.documentChunks }}</p>
            <p>{{ 'admin.systemStatus.vectorStore' | translate }}: {{ stats.vectorStore }}</p>
            <p>{{ 'admin.systemStatus.embeddingModel' | translate }}: {{ stats.embeddingModel }}</p>
            <small>{{ stats.timestamp }}</small>
          </div>
        </div>

        <div class="sources-list" *ngIf="(sources$ | async)?.sources?.length">
          <h5>{{ 'admin.systemStatus.sourcesTitle' | translate }}</h5>
          <ul>
            <li *ngFor="let source of (sources$ | async)?.sources">
              <span class="source-name">{{ source.source }}</span>
              <span class="source-meta">{{ source.chunkCount }} {{ 'admin.systemStatus.chunks' | translate }}</span>
              <span class="source-meta">{{ source.sourceType }}</span>
              <span class="source-meta">{{ source.latestUpdate }}</span>
            </li>
          </ul>
        </div>

        <div class="status-card" *ngIf="meInfo$ | async as meInfo">
          <h5>{{ 'admin.systemStatus.meTitle' | translate }}</h5>
          <p>{{ 'admin.systemStatus.meUsername' | translate }}: {{ meInfo.username }}</p>
          <p>{{ 'admin.systemStatus.meRoles' | translate }}: {{ meInfo.roles.join(', ') }}</p>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Delete Document Section -->
      <div class="section">
        <h4><i class="pi pi-trash"></i> {{ 'admin.deleteDocument.title' | translate }}</h4>
        <p>{{ 'admin.deleteDocument.description' | translate }}</p>

        <div class="delete-form">
          <p-select
            [options]="(sources$ | async)?.sources || []"
            optionLabel="source"
            optionValue="source"
            [placeholder]="'admin.deleteDocument.selectPlaceholder' | translate"
            [(ngModel)]="deleteDocumentName"
            class="delete-select"></p-select>
          <input pInputText
                 [(ngModel)]="deleteDocumentName"
                 [placeholder]="'admin.deleteDocument.placeholder' | translate"
                 class="delete-input" />
          <button pButton
                  icon="pi pi-trash"
                  [label]="'admin.deleteDocument.button' | translate"
                  class="p-button-danger"
                  (click)="deleteDocument()"
              [loading]="(isDeleting$ | async) ?? false"
              [disabled]="!deleteDocumentName.trim() || ((isDeleting$ | async) ?? false)"></button>
        </div>
      </div>

      <!-- Website Ingestion Section -->
      <div class="section">
        <h4><i class="pi pi-globe"></i> {{ 'admin.websiteIngestion.title' | translate }}</h4>
        <p>{{ 'admin.websiteIngestion.description' | translate }}</p>

        <div class="url-form">
          <div class="form-field">
            <label for="websiteUrl">{{ 'admin.websiteIngestion.urlLabel' | translate }}</label>
            <input
              pInputText
              id="websiteUrl"
              [(ngModel)]="websiteUrl"
              [placeholder]="'admin.websiteIngestion.urlPlaceholder' | translate"
              [disabled]="(isIngesting$ | async) ?? false"
              class="url-input" />
          </div>

          <div class="form-field">
            <label for="frameworkType">{{ 'admin.websiteIngestion.frameworkLabel' | translate }}</label>
            <p-select
              id="frameworkType"
              [(ngModel)]="frameworkType"
              [options]="frameworkOptions"
              [placeholder]="'admin.websiteIngestion.frameworkPlaceholder' | translate"
              [disabled]="(isIngesting$ | async) ?? false"
              [showClear]="true"
              class="framework-dropdown"></p-select>
            <small class="form-hint">{{ 'admin.websiteIngestion.frameworkHint' | translate }}</small>
          </div>

          <div class="form-field" *ngIf="frameworkType && frameworkType !== 'static'">
            <label for="customRoutes">{{ 'admin.websiteIngestion.routesLabel' | translate }}</label>
            <textarea
              pTextarea
              id="customRoutes"
              [(ngModel)]="customRoutesText"
              [placeholder]="'admin.websiteIngestion.routesPlaceholder' | translate"
              [disabled]="(isIngesting$ | async) ?? false"
              [rows]="4"
              class="routes-input"></textarea>
            <small class="form-hint">{{ 'admin.websiteIngestion.routesHint' | translate }}</small>
          </div>

          <div class="form-options">
            <div class="checkbox-field">
              <p-checkbox
                [(ngModel)]="includeLinks"
                [binary]="true"
                inputId="includeLinks"
                [disabled]="(isIngesting$ | async) ?? false"></p-checkbox>
              <label for="includeLinks">{{ 'admin.websiteIngestion.includeLinkedLabel' | translate }}</label>
            </div>

            <div class="form-field depth-field" *ngIf="includeLinks">
              <label for="maxDepth">{{ 'admin.websiteIngestion.maxDepthLabel' | translate }}</label>
              <input
                pInputText
                type="number"
                id="maxDepth"
                [(ngModel)]="maxDepth"
                [min]="1"
                [max]="3"
                [disabled]="(isIngesting$ | async) ?? false"
                class="depth-input" />
            </div>
          </div>

          <button
            pButton
            [label]="'admin.websiteIngestion.button' | translate"
            icon="pi pi-download"
            (click)="ingestWebsite()"
            [disabled]="!websiteUrl.trim() || ((isIngesting$ | async) ?? false)"
            class="ingest-button"></button>

          <p-progressBar
            *ngIf="(isIngesting$ | async)"
            mode="indeterminate"
            [style]="{'height': '6px', 'margin-top': '16px'}"></p-progressBar>

          <div *ngIf="processedUrls.length > 0" class="processed-urls">
            <h5>{{ 'admin.websiteIngestion.processedUrls' | translate: {count: processedUrls.length} }}</h5>
            <ul>
              <li *ngFor="let url of processedUrls">
                <i class="pi pi-check-circle"></i>
                <span>{{ url }}</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Information Section -->
      <div class="section info-section">
        <h4><i class="pi pi-info-circle"></i> {{ 'admin.information.title' | translate }}</h4>
        <ul>
          <li>{{ 'admin.information.items.documentUpload' | translate }}</li>
          <li>{{ 'admin.information.items.websiteIngestion' | translate }}</li>
          <li>{{ 'admin.information.items.frameworkSupport' | translate }}</li>
          <li>{{ 'admin.information.items.customRoutes' | translate }}</li>
          <li>{{ 'admin.information.items.linkedPages' | translate }}</li>
          <li>{{ 'admin.information.items.processing' | translate }}</li>
        </ul>
      </div>
    </div>
  </p-card>
</div>
